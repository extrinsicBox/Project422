
<!DOCTYPE html>
<html lang="en">
<head><!-- Google tag (gtag.js) -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Q20WJ3T4PZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Q20WJ3T4PZ');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiDARthur Mod Flight Planner - RDR2</title>

    <!-- Load Leaflet from your local files -->
    <link rel="stylesheet" href="leaflet/leaflet.css">
    <script src="leaflet/leaflet.js"></script>

    <style>
        body, html { margin: 0; padding: 0; height: 100%; }
        #map { height: 100vh; width: 100vw; }

        /* Control Panel Styling */
        .control-container {
            position: absolute;
            top: 125px;
            right: 10px;
            display: flex;
            flex-direction: column;
            align-items: flex-end; /* Align everything to the right */
            z-index: 1000;
        }

        .control-panel {
            background: white;
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 5px;
            text-align: right; /* Ensure text aligns properly */
            width: 180px; /* Keep width uniform */
			font-size: 12px;
        }
		.custom-marker {
    background-color: red; /* Change to your preferred color */
    border-radius: 50%;
    width: 10px; /* Adjust the size as needed */
    height: 10px; /* Adjust the size as needed */
    display: inline-block;
}
    </style>
</head>
<body>

    <div id="map"></div>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/6.5.0/turf.min.js"></script>
	<script src="js/utilities.js" type="module"></script>
    <script src="js/flightPath.js" type="module"></script>
    <script src="js/waypointManagement.js" type="module"></script>
    <script src="js/eventHandlers.js" type="module"></script>
    <script src="js/main.js" type="module"></script>

    <!-- Controls (Stepover, Altitude, Polygon Toggle) -->
    <div class="control-container">
        <!-- Download G-Code Button -->
       

        <!-- Stepover Input -->
        <div class="control-panel">
            <label for="stepover">Stepover (m):</label>
            <input type="number" id="stepover" value="200" step="10" min="50" max="500" onchange="updateStepover()">
        </div>

        <!-- Altitude Input -->
        <div class="control-panel">
            <label for="altitude">Altitude (m):</label>
            <input type="number" id="altitude" value="150" step="10" min="10" max="1000" onchange="updateAltitude()">
        </div>

        <!-- Polygon Visibility Toggle -->
        <div class="control-panel">
            <label>
                <input type="checkbox" id="togglePolygons" checked> Show Polygons
            </label>
        </div>
		        <div class="control-panel">
            <label>
                L-click : Draw Poly</br>
				R-Click Poly : Calc Flight</br>
				Ctrl+Drag : Draw Rect</br>
				R : Reset</br>
            </label>
		
    </div>
	
 <button id="downloadButton" onclick="exportFlightPath()" class="control-panel" checked>Download G-Code</button>
    <script>
        /* **** Leaflet **** */

        // Base layers
        var rdr = L.tileLayer('tiles/output_base/{z}/{x}/{y}.png', {tms: 1, opacity: 1.0, attribution: "", minZoom: 0, maxZoom: 18});
        var lyr = L.tileLayer('tiles/output_tiles/{z}/{x}/{y}.png', {tms: 1, opacity: 0.3, attribution: "", minZoom: 0, maxZoom: 18});

        // Map
        var map = L.map('map', {
            center: [-0.0074654676398311255, -0.01318963699874878],
            zoom: 18,
            minZoom: 0,
            maxZoom: 18,
            layers: [rdr]
        });

        var basemaps = {"RDR2 Mainland": rdr};
        var overlaymaps = {"Shaded": lyr};

        // Title
        var title = L.control();
        title.onAdd = function(map) {
            this._div = L.DomUtil.create('div', 'ctl title');
            this.update();
            return this._div;
        };
        title.update = function() {
            this._div.innerHTML = "RDR2 G-CODE FLIGHT PLANNER [BETA] ";
        };
        title.addTo(map);

        // Note
        var src = 'Generated by <a href="https://dom.riccobene.com/links">Dom Riccobene</a>, Copyright &copy; 2025';
        var note = L.control({position: 'bottomleft'});
        note.onAdd = function(map) {
            this._div = L.DomUtil.create('div', 'ctl src');
            this.update();
            return this._div;
        };
        note.update = function() {
            this._div.innerHTML = src;
        };
        note.addTo(map);

        // Add base layers
        L.control.layers(basemaps, overlaymaps, {collapsed: false}).addTo(map);

        // Fit to overlay bounds (SW and NE points with (lat, lon))
        map.fitBounds([[-0.056512335279668556, 0.03584382600250244], [0.041581400000006305, -0.062223099999999996]]);
    </script>
	<div class="control-panel">
<b>Security Testing<b/></div>
	 <div class="control-panel"><input type="text" id="testInput" placeholder="Enter test input">
<button onclick="testSanitizeInput()">Test Sanitization</button>
<div id="sanitizedOutput"></div></div>

 <div class="control-panel">
<textarea id="testGCode" placeholder="Enter G-Code"></textarea>
<button onclick="testValidateGCode()">Test G-Code Validation</button>
<div id="validationResult"></div></div>


    <script>
        function sanitizeInput(input) {
            var element = document.createElement('div');
            element.innerText = input;
            return element.innerHTML;
        }

        function testSanitizeInput() {
            let userInput = document.getElementById("testInput").value;
            let sanitizedInput = sanitizeInput(userInput);
            document.getElementById("sanitizedOutput").innerText = sanitizedInput;
        }

        function validateGCode(gcode) {
            // Add validation logic here (e.g., check for valid G-Code commands)
            return gcode.every(line => line.startsWith('G') || line.startsWith(';'));
        }

        function testValidateGCode() {
            let gcodeInput = document.getElementById("testGCode").value.split('\n');
            let isValid = validateGCode(gcodeInput);
            document.getElementById("validationResult").innerText = isValid ? "Valid G-Code" : "Invalid G-Code";
        }
    </script>
</body>
</html>
